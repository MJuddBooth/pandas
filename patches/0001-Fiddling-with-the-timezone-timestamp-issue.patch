From b44ce920e1dd69bdf78c95de43d4656c5b0c1d9d Mon Sep 17 00:00:00 2001
From: Michael Booth <m.judd.booth@gmail.com>
Date: Tue, 4 Jul 2017 17:50:57 -0400
Subject: [PATCH] Fiddling with the timezone/timestamp issue.

---
 pandas/core/algorithms.py  | 5 +++++
 pandas/tseries/resample.py | 4 ++--
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/pandas/core/algorithms.py b/pandas/core/algorithms.py
index 4b40bce79..12b435263 100644
--- a/pandas/core/algorithms.py
+++ b/pandas/core/algorithms.py
@@ -217,6 +217,11 @@ def factorize(values, sort=False, order=None, na_sentinel=-1, size_hint=None):
     if is_datetimetz:
 
         # reset tz
+        # This does not seem to work with repeated hours. 
+        # There is an ambiguous time, but because the 
+        # values are now unique, the repeated hour is tossed,
+        # so that even calling with ambiuous="infer" will not
+        # help 
         uniques = DatetimeIndex(uniques.astype('M8[ns]')).tz_localize(
             values.tz)
     elif is_datetime:
diff --git a/pandas/tseries/resample.py b/pandas/tseries/resample.py
index 8d6955ab4..df115c1ba 100644
--- a/pandas/core/resample.py
+++ b/pandas/core/resample.py
@@ -1076,8 +1076,8 @@ class TimeGrouper(Grouper):
         # thus last bin maybe slightly before the end if the end contains
         # nanosecond part and lead to `Values falls after last bin` error
         binner = labels = DatetimeIndex(freq=self.freq,
-                                        start=first,
-                                        end=last,
+                                        start=first.tz_localize(None),
+                                        end=last.tz_localize(None),
                                         tz=tz,
                                         name=ax.name)
 
-- 
2.13.3

